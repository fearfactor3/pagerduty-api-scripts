# Cloud-SRE-PagerDuty-Backup

## Summary
The Cloud SRE team has created this repo as a way of storing PagerDuty resources and it is made with a PagerDuty API. The created python scripts allows for listing the current PagerDuty resources and writing those in json objects in order to facilitate their recovery. Each folder, named by its resource, should include a large json file containing all of the resource's objects as well as an "individual" folder that contains all of the resource's objects in individual json files identified by its ID.

This way of acquiring all of this data and writing the json files is currently being made resorting to a scheduled GitHub action workflow that is run everyday.

**_Important note_**: In order to make use of this API and perform these operations, first a PagerDuty API Key is required which can only be generated by a PagerDuty admin.

#### Current folder structure
```
repo
│   README.md
│   main.py    
│
└───pagerduty-files
│   │
│   └───business_services
│   │   │   business_services.json
│   │   │
│   │   └───individual
│   │       │   business_serviceID1.json
│   │       │   ...
│   │
│   └───escalation_policies
│   │   │   escalation_policies.json  
│   │   │
│   │   └───individual
│   │       │   escalation_policyID1.json
│   │       │   ...
│   │   ...

```

As for the event rules, these follow a slightly different folder structure where the one json file containing all of the event rules still exist but instead of being individually put into an "individual" folder they are grouped, individually, by the ruleset that they are attached to.

```
repo
│   README.md
│   main.py    
│
└───pagerduty-files
│   │
│   └───event_rules
│   │   │   event_rules.json
│   │   │
│   │   └───rulesets
│   │       │
│   │       └───rulesetID1
│   │       │   │   event_ruleID1.json
│   │       │   │   ...
│   │       │
│   │       └───rulesetID2
│   │       │   │   event_ruleID1.json
│   │       │   │   ...
│   │       ...
│   │
```

## Current listed resources
* Business Services
* Escalation Policies
* Rulesets
  * Event Rules
* Priorities
* Schedules
* Services
* Teams
* Users

## Usage
- Have **Python3** installed
- Install the necessary packages `pip3 install -r requirements.txt`
- Create a `.env` file with the following content: `PD_API_KEY = $INSERT_PAGERDUTY_TOKEN_HERE`
- Run code `python3 main.py`


## Documentation
[PagerDuty API Reference](https://developer.pagerduty.com/api-reference/e65c5833eeb07-pager-duty-api)

[Python client for PagerDuty API (pdpyras)](https://pagerduty.github.io/pdpyras/#)
